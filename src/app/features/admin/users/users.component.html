<div class="users-container">
  <p-toast />
  <p-confirmDialog />

  <div class="card">
    <p-toolbar>
      <div class="p-toolbar-group-start">
        <h2 class="text-2xl font-bold m-0">User Management</h2>
      </div>
      <div class="p-toolbar-group-end">
        <p-button
          label="Add User"
          icon="pi pi-plus"
          (click)="openNew()"
          styleClass="p-button-success"
        />
      </div>
    </p-toolbar>

   
    <p-table
      #dt
      [value]="filteredData()"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      [globalFilterFields]="['firstName', 'lastName', 'email', 'phone']"
      [tableStyle]="{ 'min-width': '50rem' }"
      [paginator]="true"
      [showCurrentPageReport]="true"
      [currentPageReportTemplate]="'Showing {first} to {last} of {totalRecords} entries'"
      [rowHover]="true"
      dataKey="id"
      [loading]="loading()"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="firstName">
            Name <p-sortIcon field="firstName" />
          </th>
          <th pSortableColumn="email">
            Email <p-sortIcon field="email" />
          </th>
          <th pSortableColumn="role">
            Role <p-sortIcon field="role" />
          </th>
          <th pSortableColumn="department">
            Department <p-sortIcon field="department" />
          </th>
          <th pSortableColumn="status">
            Status <p-sortIcon field="status" />
          </th>
          <th pSortableColumn="phone">Phone</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-user>
        <tr>
          <td>{{ user.firstName }} {{ user.lastName }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.role }}</td>
          <td>{{ user.department }}</td>
          <td>
            {{user.status}}
          </td>
          <td>{{ user.phone }}</td>
          <td>
            <div class="action-buttons">
              <p-button
                icon="pi pi-pencil"
                (click)="editUser(user)"
                styleClass="p-button-text p-button-rounded p-button-success"
                [pTooltip]="'Edit'"
                pTooltipPosition="top"
              />
              <p-button
                icon="pi pi-trash"
                (click)="deleteUser(user)"
                styleClass="p-button-text p-button-rounded p-button-danger"
                [pTooltip]="'Delete'"
                pTooltipPosition="top"
              />
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8" class="text-center p-4">
            <p class="text-gray-500">No users found</p>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <p-dialog
    [header]="editingUser() ? 'Edit User' : 'Add User'"
    [(visible)]="displayDialog"
    [modal]="true"
    [style]="{ width: '500px' }"
    (onHide)="onDialogHide()"
  >
    <form [formGroup]="userForm" class="user-form">
      <div class="form-group">
        <label for="firstName">First Name *</label>
        <input
          id="firstName"
          type="text"
          pInputText
          formControlName="firstName"
          placeholder="Enter first name"
          class="w-full"
          [validationError]="{required: 'First Name is required'}"
        />
      </div>

      <div class="form-group">
        <label for="lastName">Last Name *</label>
        <input
          id="lastName"
          type="text"
          pInputText
          formControlName="lastName"
          placeholder="Enter last name"
          class="w-full"
          [validationError]="{required: 'Last Name is required'}"
        />
      </div>

      <div class="form-group">
        <label for="email">Email *</label>
        <input
          id="email"
          type="email"
          pInputText
          formControlName="email"
          placeholder="Enter email"
          class="w-full"
          [validationError]="{required: 'First Name is required'}"
        />
      </div>

      <div class="form-group">
        <label for="phone">Phone</label>
        <input
          id="phone"
          type="text"
          pInputText
          formControlName="phone"
          placeholder="Enter phone number"
          class="w-full"
        />
      </div>

      <div class="form-group">
        <label for="role">Role *</label>
        <p-select
          id="role"
          [options]="roles()"
          formControlName="role"
          placeholder="Select role"
          class="w-full"
        />
      </div>

      <div class="form-group">
        <label for="department">Department</label>
        <p-select
          id="department"
          [options]="departments()"
          formControlName="department"
          placeholder="Select department"
          class="w-full"
        />
      </div>

      <div class="form-group">
        <label for="status">Status</label>
        <p-select
          id="status"
          [options]="statuses()"
          formControlName="status"
          placeholder="Select status"
          class="w-full"
        />
      </div>
    </form>

    <ng-template pTemplate="footer">
      <p-button
        label="Cancel"
        severity="contrast"
        outlined
        (click)="displayDialog.set(false)"
        styleClass="p-button-text"
      />
      <p-button
        label="Save"
        severity="success"
        (click)="saveUser()"
        [disabled]="userForm.invalid"
      />
    </ng-template>
  </p-dialog>
</div>

